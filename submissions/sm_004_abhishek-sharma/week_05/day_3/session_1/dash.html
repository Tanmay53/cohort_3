<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Redirect Page</title>
</head>

<body>
    <button id="logout">Logout</button>

    <script>
        var verbose = 1

        var regularObj = JSON.parse(localStorage.getItem("data"))
        console.log(regularObj)
        var size = regularObj.length
        var currentUser = regularObj[size - 1].username
        console.log(currentUser)

        var event = new Date();
        var oldTime = new Date();
        event.setMinutes(event.getMinutes() + 5);
        // console.log(oldTime)
        // console.log(event)

        // Printing Current User Name
        var bodyElem = document.querySelector("body")
        var firstDiv = document.createElement("div")
        bodyElem.appendChild(firstDiv)
        var userName = document.createElement("h1")
        firstDiv.appendChild(userName)
        userName.innerHTML = currentUser

        // Displaying Login Time
        var timeStamp = document.createElement("div")
        bodyElem.appendChild(timeStamp)
        var curTimeLabel = document.createElement("label")
        curTimeLabel.textContent = "Login Time: "
        timeStamp.appendChild(curTimeLabel)
        var curTime = document.createElement("p")
        curTime.innerHTML = oldTime
        curTimeLabel.appendChild(curTime)

        // Displaying Logout Time
        var timeLimit = document.createElement("label")
        timeLimit.textContent = "Logout Time: "
        timeStamp.appendChild(timeLimit)
        var logoutTime = document.createElement("p")
        logoutTime.innerHTML = event
        timeStamp.appendChild(logoutTime)

        var logout = document.getElementById("logout")
        logout.addEventListener("click", userLogout)

        function userLogout(){
            window.location.href = "/home/skynet/repos/cohort_3/submissions/sm_004_abhishek-sharma/week_05/day_3/session_1/index.html"
        }

        // Setting Timer for 5 mins
        var count = 300
        var c = setInterval( function(){
            //   console.log('Time is',count)
              count--
              if(count==0){
                clearInterval(c)
                console.log('stopping timer')
                window.location.href = "/home/skynet/repos/cohort_3/submissions/sm_004_abhishek-sharma/week_05/day_3/session_1/index.html"
                }
            }, 1000)

        // Getting only Login Time
        var presentTime = new Date();
        var hours = presentTime.getHours();
        var minutes = presentTime.getMinutes();
        var seconds = presentTime.getSeconds();
        if(minutes < "10"){
            minutes = "0" + minutes
        }
        var loginTime = hours + ":" + minutes + ":" + seconds
        console.log(presentTime)
        console.log(loginTime)

        // Storing Login Time of Users
        var loginDetails = []
        var obj2 = {
            user : currentUser,
            punchIn : loginTime                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
        }
        loginDetails.push(obj2)
        if(verbose){
            console.log('adding users data', obj2)
            console.log('user login details are', loginDetails)
        }
        var output2 = JSON.stringify(loginDetails)
        console.log(output2)
        localStorage.setItem("login", output2)

    </script>
</body>

</html>